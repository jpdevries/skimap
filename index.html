<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Pow Press - Willamette Pass</title>
    <meta name="description" content="View of Odell Lake from the summit of Willamette Pass Willamette Pass Resort is a ski area located in Klamath County, Oregon.&#8230;">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link rel="stylesheet" href="assets/css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>

    <link href='http://fonts.googleapis.com/css?family=Cuprum:400,700,700italic,400italic' rel='stylesheet' type='text/css'>
</head>
<body class="t-15 id-13 p-3 ck-modDocument" data-highlight-ridden="1" data-site-name="Pow Press" data-skip-map="">
    <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->
    <div id="wrapper">
        <div class="tr" style="">
            <div class="td map">
                <div id="map-canvas">
                    <ul>
                        <!-- list all the resorts. we'll loop over these with jQuery and add a pin for each one -->
                    </ul>
                </div>
            </div>
            <aside class="td map-side" style="">
                <div class="fixed">
                    <div class="content"><!-- this is where our AJAX content will go -->
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- javascript includes -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script>
        window.jQuery || document.write('<script src="assets/components/boilerx/js/vendor/jquery-1.8.3.min.js"><\/script>')
    </script>
    <script type="text/javascript" src="assets/js/jquery.address-1.5.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAVzVg-8MUh3sa-aEAMm4GsFGY-k4ofwcY&sensor=true">
    </script>
    <script type="text/javascript">
        $('document').ready(function() {
            $.address.state('/');

            var _pins = [];
            $('#map-canvas > ul > li').each(function() { // for each of our map pins
                // pull some data out of the DOM
                var _title = $(this).find('h3').html();
                var _lat = $(this).find('.lat').html();
                var _lng = $(this).find('.lng').html();
                
                _pins.push({ // push a DTO object for each pin into _pins Array
                    title: _title,
                    lat: _lat,
                    lng: _lng,
                    href: $(this).data('href'),
                    ajax: $(this).data('ajax'),
                    ridden: $(this).data('ridden'),
                    id: $(this).data('id')
                });
            });

            // create the map
            var mapOptions = {
                center: new google.maps.LatLng(43.601667, -122.031667),
                zoom: 7,
                minZoom: 5,
                mapTypeId: google.maps.MapTypeId.TERRAIN
            };
            var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
            
            var _openWindow;
            var _showRidden = ($('body').data('highlight-ridden') == '1') ? true : false;
            var _markers = [];
            var _circles = [];

            var _clickedMarker;
            for (var i = 0; i < _pins.length; i++) { // for each pin
                var infowindow = new google.maps.InfoWindow({ // create an info window
                    content: '<div class="infowindow"><h1>' + _pins[i].title + '</h1></div>'
                });

                var marker = new google.maps.Marker({ // create a marker
                    position: new google.maps.LatLng(_pins[i].lat, _pins[i].lng),
                    map: map,
                    title: _pins[i].title,
                    pid: i,
                    href: _pins[i].href,
                    ajax: _pins[i].ajax,
                    zIndex: (_pins[i].ridden) ? 1000 + i : i,
                    icon: 'assets/img/' + ((_showRidden && _pins[i].ridden) ? 'icon_snowboarding_ridden.png' : 'icon_snowboarding.png')
                });

                if (marker.pid == 13) _clickedMarker = marker; // 13 is the id of the current "page"

                _markers.push(marker);

                var populationOptions = { // used to create circle overlays
                    strokeColor: (_pins[i].ridden) ? "#f5f375" : "#f5f375",
                    strokeOpacity: 0.6,
                    strokeWeight: 2,
                    fillColor: (_pins[i].ridden) ? "#f5f375" : "#f5f375",
                    fillOpacity: 0.6,
                    pid: i,
                    center: new google.maps.LatLng(_pins[i].lat, _pins[i].lng),
                    radius: 5600,
                    map: (_pins[i].id == 13) ? map : null
                };
                cityCircle = new google.maps.Circle(populationOptions);
                _circles.push(cityCircle);

                // process multiple info windows
                (function(marker, i, _clickedMarker) {
                    // add click event
                    google.maps.event.addListener(marker, 'click', function() { // when a pin is clicked
                        if (!'1') {
                            document.location = marker.href;
                            return;
                        }
                        var k = _circles.length;
                        for (var j = 0; j < k; j++) { // add circles to each pin
                            _circles[j].setMap((_circles[j].pid == marker.pid) ? map : null);
                        }

                        $.ajax({
                            type: "GET",
                            url: marker.ajax, // make the request to the API endpoint, ex: http://powpass.us/north-america/westcoast/washington/sitzmark-lifts.html?ajax=1
                            success: function(data) {
                                $('.map-side .content').empty().html(data); // empty the content area
                                $.address.value(marker.href); // update the URL async
                                $.address.title($('body').data('site-name') + ' - ' + marker.title); // update the title
                                asideListeners(); // reasign click listener
                                if (window.innerWidth <= 768) { // on mobile animate to content area
                                    $("html, body").animate({
                                        scrollTop: $('.map-side').offset().top
                                    }, 240);
                                }
                            }
                        });
                        _clickedMarker = marker;
                    });
                })(marker, i);
            }
            // support jumping past map using sm URL param
            if (window.innerWidth <= 768 && $('body').data('skip-map')) $("html, body").animate({
                scrollTop: $('.map-side').offset().top
            }, 240);

            function asideListeners() {
                $('h1 span').click(function(e) {
                    if (_clickedMarker) {
                        map.setCenter(marker.getPosition());
                        map.setZoom(10);
                    }
                });
            }
            asideListeners();

        });
    </script>
</body>

</html>